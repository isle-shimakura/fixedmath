#include "fixedmath.h"

#define ATAN_TABLE_LENGTH (1<<11) /* 45“x‚Ì•ªŠ„” */
static const int16_t atan_table[] = {
	   0,   2,   5,   7,  10,  12,  15,  17,
	  20,  22,  25,  28,  30,  33,  35,  38,
	  40,  43,  45,  48,  50,  53,  56,  58,
	  61,  63,  66,  68,  71,  73,  76,  78,
	  81,  84,  86,  89,  91,  94,  96,  99,
	 101, 104, 106, 109, 112, 114, 117, 119,
	 122, 124, 127, 129, 132, 134, 137, 140,
	 142, 145, 147, 150, 152, 155, 157, 160,
	 162, 165, 168, 170, 173, 175, 178, 180,
	 183, 185, 188, 190, 193, 195, 198, 201,
	 203, 206, 208, 211, 213, 216, 218, 221,
	 223, 226, 229, 231, 234, 236, 239, 241,
	 244, 246, 249, 251, 254, 256, 259, 262,
	 264, 267, 269, 272, 274, 277, 279, 282,
	 284, 287, 289, 292, 295, 297, 300, 302,
	 305, 307, 310, 312, 315, 317, 320, 322,
	 325, 328, 330, 333, 335, 338, 340, 343,
	 345, 348, 350, 353, 355, 358, 361, 363,
	 366, 368, 371, 373, 376, 378, 381, 383,
	 386, 388, 391, 393, 396, 399, 401, 404,
	 406, 409, 411, 414, 416, 419, 421, 424,
	 426, 429, 431, 434, 436, 439, 442, 444,
	 447, 449, 452, 454, 457, 459, 462, 464,
	 467, 469, 472, 474, 477, 479, 482, 484,
	 487, 490, 492, 495, 497, 500, 502, 505,
	 507, 510, 512, 515, 517, 520, 522, 525,
	 527, 530, 532, 535, 537, 540, 542, 545,
	 548, 550, 553, 555, 558, 560, 563, 565,
	 568, 570, 573, 575, 578, 580, 583, 585,
	 588, 590, 593, 595, 598, 600, 603, 605,
	 608, 610, 613, 615, 618, 620, 623, 625,
	 628, 630, 633, 635, 638, 641, 643, 646,
	 648, 651, 653, 656, 658, 661, 663, 666,
	 668, 671, 673, 676, 678, 681, 683, 686,
	 688, 691, 693, 696, 698, 701, 703, 706,
	 708, 711, 713, 716, 718, 721, 723, 726,
	 728, 731, 733, 736, 738, 741, 743, 746,
	 748, 751, 753, 756, 758, 761, 763, 766,
	 768, 771, 773, 775, 778, 780, 783, 785,
	 788, 790, 793, 795, 798, 800, 803, 805,
	 808, 810, 813, 815, 818, 820, 823, 825,
	 828, 830, 833, 835, 838, 840, 843, 845,
	 848, 850, 853, 855, 857, 860, 862, 865,
	 867, 870, 872, 875, 877, 880, 882, 885,
	 887, 890, 892, 895, 897, 900, 902, 904,
	 907, 909, 912, 914, 917, 919, 922, 924,
	 927, 929, 932, 934, 937, 939, 942, 944,
	 946, 949, 951, 954, 956, 959, 961, 964,
	 966, 969, 971, 974, 976, 978, 981, 983,
	 986, 988, 991, 993, 996, 998,1001,1003,
	1005,1008,1010,1013,1015,1018,1020,1023,
	1025,1027,1030,1032,1035,1037,1040,1042,
	1045,1047,1050,1052,1054,1057,1059,1062,
	1064,1067,1069,1071,1074,1076,1079,1081,
	1084,1086,1089,1091,1093,1096,1098,1101,
	1103,1106,1108,1110,1113,1115,1118,1120,
	1123,1125,1127,1130,1132,1135,1137,1140,
	1142,1144,1147,1149,1152,1154,1157,1159,
	1161,1164,1166,1169,1171,1174,1176,1178,
	1181,1183,1186,1188,1190,1193,1195,1198,
	1200,1203,1205,1207,1210,1212,1215,1217,
	1219,1222,1224,1227,1229,1231,1234,1236,
	1239,1241,1244,1246,1248,1251,1253,1256,
	1258,1260,1263,1265,1268,1270,1272,1275,
	1277,1280,1282,1284,1287,1289,1291,1294,
	1296,1299,1301,1303,1306,1308,1311,1313,
	1315,1318,1320,1323,1325,1327,1330,1332,
	1334,1337,1339,1342,1344,1346,1349,1351,
	1354,1356,1358,1361,1363,1365,1368,1370,
	1373,1375,1377,1380,1382,1384,1387,1389,
	1392,1394,1396,1399,1401,1403,1406,1408,
	1410,1413,1415,1418,1420,1422,1425,1427,
	1429,1432,1434,1436,1439,1441,1443,1446,
	1448,1451,1453,1455,1458,1460,1462,1465,
	1467,1469,1472,1474,1476,1479,1481,1483,
	1486,1488,1490,1493,1495,1498,1500,1502,
	1505,1507,1509,1512,1514,1516,1519,1521,
	1523,1526,1528,1530,1533,1535,1537,1540,
	1542,1544,1547,1549,1551,1554,1556,1558,
	1561,1563,1565,1567,1570,1572,1574,1577,
	1579,1581,1584,1586,1588,1591,1593,1595,
	1598,1600,1602,1605,1607,1609,1612,1614,
	1616,1618,1621,1623,1625,1628,1630,1632,
	1635,1637,1639,1642,1644,1646,1648,1651,
	1653,1655,1658,1660,1662,1664,1667,1669,
	1671,1674,1676,1678,1681,1683,1685,1687,
	1690,1692,1694,1697,1699,1701,1703,1706,
	1708,1710,1713,1715,1717,1719,1722,1724,
	1726,1729,1731,1733,1735,1738,1740,1742,
	1744,1747,1749,1751,1754,1756,1758,1760,
	1763,1765,1767,1769,1772,1774,1776,1778,
	1781,1783,1785,1787,1790,1792,1794,1796,
	1799,1801,1803,1806,1808,1810,1812,1815,
	1817,1819,1821,1824,1826,1828,1830,1833,
	1835,1837,1839,1841,1844,1846,1848,1850,
	1853,1855,1857,1859,1862,1864,1866,1868,
	1871,1873,1875,1877,1879,1882,1884,1886,
	1888,1891,1893,1895,1897,1900,1902,1904,
	1906,1908,1911,1913,1915,1917,1919,1922,
	1924,1926,1928,1931,1933,1935,1937,1939,
	1942,1944,1946,1948,1950,1953,1955,1957,
	1959,1961,1964,1966,1968,1970,1972,1975,
	1977,1979,1981,1983,1986,1988,1990,1992,
	1994,1997,1999,2001,2003,2005,2008,2010,
	2012,2014,2016,2019,2021,2023,2025,2027,
	2029,2032,2034,2036,2038,2040,2042,2045,
	2047,2049,2051,2053,2056,2058,2060,2062,
	2064,2066,2069,2071,2073,2075,2077,2079,
	2082,2084,2086,2088,2090,2092,2094,2097,
	2099,2101,2103,2105,2107,2110,2112,2114,
	2116,2118,2120,2122,2125,2127,2129,2131,
	2133,2135,2137,2140,2142,2144,2146,2148,
	2150,2152,2155,2157,2159,2161,2163,2165,
	2167,2170,2172,2174,2176,2178,2180,2182,
	2184,2187,2189,2191,2193,2195,2197,2199,
	2201,2203,2206,2208,2210,2212,2214,2216,
	2218,2220,2223,2225,2227,2229,2231,2233,
	2235,2237,2239,2241,2244,2246,2248,2250,
	2252,2254,2256,2258,2260,2262,2265,2267,
	2269,2271,2273,2275,2277,2279,2281,2283,
	2286,2288,2290,2292,2294,2296,2298,2300,
	2302,2304,2306,2308,2311,2313,2315,2317,
	2319,2321,2323,2325,2327,2329,2331,2333,
	2335,2337,2340,2342,2344,2346,2348,2350,
	2352,2354,2356,2358,2360,2362,2364,2366,
	2368,2370,2372,2375,2377,2379,2381,2383,
	2385,2387,2389,2391,2393,2395,2397,2399,
	2401,2403,2405,2407,2409,2411,2413,2415,
	2418,2420,2422,2424,2426,2428,2430,2432,
	2434,2436,2438,2440,2442,2444,2446,2448,
	2450,2452,2454,2456,2458,2460,2462,2464,
	2466,2468,2470,2472,2474,2476,2478,2480,
	2482,2484,2486,2488,2490,2492,2494,2496,
	2498,2500,2502,2504,2506,2508,2510,2512,
	2514,2516,2518,2520,2522,2524,2526,2528,
	2530,2532,2534,2536,2538,2540,2542,2544,
	2546,2548,2550,2552,2554,2556,2558,2560,
	2562,2564,2566,2568,2570,2572,2574,2576,
	2578,2580,2582,2584,2586,2588,2590,2592,
	2594,2596,2598,2600,2602,2604,2605,2607,
	2609,2611,2613,2615,2617,2619,2621,2623,
	2625,2627,2629,2631,2633,2635,2637,2639,
	2641,2643,2645,2646,2648,2650,2652,2654,
	2656,2658,2660,2662,2664,2666,2668,2670,
	2672,2674,2676,2678,2679,2681,2683,2685,
	2687,2689,2691,2693,2695,2697,2699,2701,
	2703,2704,2706,2708,2710,2712,2714,2716,
	2718,2720,2722,2724,2726,2727,2729,2731,
	2733,2735,2737,2739,2741,2743,2745,2747,
	2748,2750,2752,2754,2756,2758,2760,2762,
	2764,2766,2767,2769,2771,2773,2775,2777,
	2779,2781,2783,2784,2786,2788,2790,2792,
	2794,2796,2798,2800,2801,2803,2805,2807,
	2809,2811,2813,2815,2816,2818,2820,2822,
	2824,2826,2828,2829,2831,2833,2835,2837,
	2839,2841,2843,2844,2846,2848,2850,2852,
	2854,2856,2857,2859,2861,2863,2865,2867,
	2869,2870,2872,2874,2876,2878,2880,2881,
	2883,2885,2887,2889,2891,2893,2894,2896,
	2898,2900,2902,2904,2905,2907,2909,2911,
	2913,2915,2916,2918,2920,2922,2924,2925,
	2927,2929,2931,2933,2935,2936,2938,2940,
	2942,2944,2946,2947,2949,2951,2953,2955,
	2956,2958,2960,2962,2964,2965,2967,2969,
	2971,2973,2974,2976,2978,2980,2982,2984,
	2985,2987,2989,2991,2992,2994,2996,2998,
	3000,3001,3003,3005,3007,3009,3010,3012,
	3014,3016,3018,3019,3021,3023,3025,3026,
	3028,3030,3032,3034,3035,3037,3039,3041,
	3042,3044,3046,3048,3050,3051,3053,3055,
	3057,3058,3060,3062,3064,3065,3067,3069,
	3071,3073,3074,3076,3078,3080,3081,3083,
	3085,3087,3088,3090,3092,3094,3095,3097,
	3099,3101,3102,3104,3106,3108,3109,3111,
	3113,3115,3116,3118,3120,3121,3123,3125,
	3127,3128,3130,3132,3134,3135,3137,3139,
	3141,3142,3144,3146,3147,3149,3151,3153,
	3154,3156,3158,3160,3161,3163,3165,3166,
	3168,3170,3172,3173,3175,3177,3178,3180,
	3182,3184,3185,3187,3189,3190,3192,3194,
	3195,3197,3199,3201,3202,3204,3206,3207,
	3209,3211,3212,3214,3216,3218,3219,3221,
	3223,3224,3226,3228,3229,3231,3233,3234,
	3236,3238,3240,3241,3243,3245,3246,3248,
	3250,3251,3253,3255,3256,3258,3260,3261,
	3263,3265,3266,3268,3270,3271,3273,3275,
	3276,3278,3280,3281,3283,3285,3286,3288,
	3290,3291,3293,3295,3296,3298,3300,3301,
	3303,3305,3306,3308,3310,3311,3313,3314,
	3316,3318,3319,3321,3323,3324,3326,3328,
	3329,3331,3333,3334,3336,3338,3339,3341,
	3342,3344,3346,3347,3349,3351,3352,3354,
	3355,3357,3359,3360,3362,3364,3365,3367,
	3368,3370,3372,3373,3375,3377,3378,3380,
	3381,3383,3385,3386,3388,3390,3391,3393,
	3394,3396,3398,3399,3401,3402,3404,3406,
	3407,3409,3410,3412,3414,3415,3417,3418,
	3420,3422,3423,3425,3426,3428,3430,3431,
	3433,3434,3436,3438,3439,3441,3442,3444,
	3446,3447,3449,3450,3452,3453,3455,3457,
	3458,3460,3461,3463,3465,3466,3468,3469,
	3471,3472,3474,3476,3477,3479,3480,3482,
	3483,3485,3487,3488,3490,3491,3493,3494,
	3496,3498,3499,3501,3502,3504,3505,3507,
	3508,3510,3512,3513,3515,3516,3518,3519,
	3521,3522,3524,3526,3527,3529,3530,3532,
	3533,3535,3536,3538,3539,3541,3543,3544,
	3546,3547,3549,3550,3552,3553,3555,3556,
	3558,3559,3561,3563,3564,3566,3567,3569,
	3570,3572,3573,3575,3576,3578,3579,3581,
	3582,3584,3585,3587,3588,3590,3591,3593,
	3595,3596,3598,3599,3601,3602,3604,3605,
	3607,3608,3610,3611,3613,3614,3616,3617,
	3619,3620,3622,3623,3625,3626,3628,3629,
	3631,3632,3634,3635,3637,3638,3640,3641,
	3643,3644,3646,3647,3649,3650,3652,3653,
	3655,3656,3658,3659,3661,3662,3664,3665,
	3666,3668,3669,3671,3672,3674,3675,3677,
	3678,3680,3681,3683,3684,3686,3687,3689,
	3690,3692,3693,3694,3696,3697,3699,3700,
	3702,3703,3705,3706,3708,3709,3711,3712,
	3714,3715,3716,3718,3719,3721,3722,3724,
	3725,3727,3728,3730,3731,3732,3734,3735,
	3737,3738,3740,3741,3743,3744,3745,3747,
	3748,3750,3751,3753,3754,3756,3757,3758,
	3760,3761,3763,3764,3766,3767,3768,3770,
	3771,3773,3774,3776,3777,3778,3780,3781,
	3783,3784,3786,3787,3788,3790,3791,3793,
	3794,3796,3797,3798,3800,3801,3803,3804,
	3805,3807,3808,3810,3811,3813,3814,3815,
	3817,3818,3820,3821,3822,3824,3825,3827,
	3828,3829,3831,3832,3834,3835,3836,3838,
	3839,3841,3842,3843,3845,3846,3848,3849,
	3850,3852,3853,3855,3856,3857,3859,3860,
	3862,3863,3864,3866,3867,3868,3870,3871,
	3873,3874,3875,3877,3878,3879,3881,3882,
	3884,3885,3886,3888,3889,3890,3892,3893,
	3895,3896,3897,3899,3900,3901,3903,3904,
	3906,3907,3908,3910,3911,3912,3914,3915,
	3916,3918,3919,3921,3922,3923,3925,3926,
	3927,3929,3930,3931,3933,3934,3935,3937,
	3938,3939,3941,3942,3944,3945,3946,3948,
	3949,3950,3952,3953,3954,3956,3957,3958,
	3960,3961,3962,3964,3965,3966,3968,3969,
	3970,3972,3973,3974,3976,3977,3978,3980,
	3981,3982,3984,3985,3986,3988,3989,3990,
	3992,3993,3994,3996,3997,3998,4000,4001,
	4002,4004,4005,4006,4007,4009,4010,4011,
	4013,4014,4015,4017,4018,4019,4021,4022,
	4023,4025,4026,4027,4028,4030,4031,4032,
	4034,4035,4036,4038,4039,4040,4041,4043,
	4044,4045,4047,4048,4049,4051,4052,4053,
	4054,4056,4057,4058,4060,4061,4062,4063,
	4065,4066,4067,4069,4070,4071,4072,4074,
	4075,4076,4078,4079,4080,4081,4083,4084,
	4085,4087,4088,4089,4090,4092,4093,4094,
	4096
};

int atan21(int y, int x)
{
	if (y >= 0) {
		if (x >= 0) {
			if (y < x) {
				return atan_table[y*ATAN_TABLE_LENGTH/x];
			}
			if (y == 0) {
				return 0;
			}
			return M_PI/2*1 - atan_table[x*ATAN_TABLE_LENGTH/y];
		}
		y = -y;
		if (y > x) {
			return M_PI/2*2 - atan_table[y*ATAN_TABLE_LENGTH/x];
		}
		return M_PI/2*1 + atan_table[x*ATAN_TABLE_LENGTH/y];
	}
	if (x <= 0) {
		if (y > x) {
			return M_PI/2*2 + atan_table[y*ATAN_TABLE_LENGTH/x];
		}
		return M_PI/2*3 - atan_table[x*ATAN_TABLE_LENGTH/y];
	}
	x = -x;
	if (y > x) {
		return M_PI/2*4 - atan_table[y*ATAN_TABLE_LENGTH/x];
	}
	return M_PI/2*3 + atan_table[x*ATAN_TABLE_LENGTH/y];
}
