#include "fixedmath.h"

#define ATAN_TABLE_LENGTH (1<<10) /* 45“x‚Ì•ªŠ„” */
static const short atan_table[] = {
	   0,   5,  10,  15,  20,  25,  30,  35,
	  40,  45,  50,  56,  61,  66,  71,  76,
	  81,  86,  91,  96, 101, 106, 112, 117,
	 122, 127, 132, 137, 142, 147, 152, 157,
	 162, 168, 173, 178, 183, 188, 193, 198,
	 203, 208, 213, 218, 223, 229, 234, 239,
	 244, 249, 254, 259, 264, 269, 274, 279,
	 284, 289, 295, 300, 305, 310, 315, 320,
	 325, 330, 335, 340, 345, 350, 355, 361,
	 366, 371, 376, 381, 386, 391, 396, 401,
	 406, 411, 416, 421, 426, 431, 436, 442,
	 447, 452, 457, 462, 467, 472, 477, 482,
	 487, 492, 497, 502, 507, 512, 517, 522,
	 527, 532, 537, 542, 548, 553, 558, 563,
	 568, 573, 578, 583, 588, 593, 598, 603,
	 608, 613, 618, 623, 628, 633, 638, 643,
	 648, 653, 658, 663, 668, 673, 678, 683,
	 688, 693, 698, 703, 708, 713, 718, 723,
	 728, 733, 738, 743, 748, 753, 758, 763,
	 768, 773, 778, 783, 788, 793, 798, 803,
	 808, 813, 818, 823, 828, 833, 838, 843,
	 848, 853, 857, 862, 867, 872, 877, 882,
	 887, 892, 897, 902, 907, 912, 917, 922,
	 927, 932, 937, 942, 946, 951, 956, 961,
	 966, 971, 976, 981, 986, 991, 996,1001,
	1005,1010,1015,1020,1025,1030,1035,1040,
	1045,1050,1054,1059,1064,1069,1074,1079,
	1084,1089,1093,1098,1103,1108,1113,1118,
	1123,1127,1132,1137,1142,1147,1152,1157,
	1161,1166,1171,1176,1181,1186,1190,1195,
	1200,1205,1210,1215,1219,1224,1229,1234,
	1239,1244,1248,1253,1258,1263,1268,1272,
	1277,1282,1287,1291,1296,1301,1306,1311,
	1315,1320,1325,1330,1334,1339,1344,1349,
	1354,1358,1363,1368,1373,1377,1382,1387,
	1392,1396,1401,1406,1410,1415,1420,1425,
	1429,1434,1439,1443,1448,1453,1458,1462,
	1467,1472,1476,1481,1486,1490,1495,1500,
	1505,1509,1514,1519,1523,1528,1533,1537,
	1542,1547,1551,1556,1561,1565,1570,1574,
	1579,1584,1588,1593,1598,1602,1607,1612,
	1616,1621,1625,1630,1635,1639,1644,1648,
	1653,1658,1662,1667,1671,1676,1681,1685,
	1690,1694,1699,1703,1708,1713,1717,1722,
	1726,1731,1735,1740,1744,1749,1754,1758,
	1763,1767,1772,1776,1781,1785,1790,1794,
	1799,1803,1808,1812,1817,1821,1826,1830,
	1835,1839,1844,1848,1853,1857,1862,1866,
	1871,1875,1879,1884,1888,1893,1897,1902,
	1906,1911,1915,1919,1924,1928,1933,1937,
	1942,1946,1950,1955,1959,1964,1968,1972,
	1977,1981,1986,1990,1994,1999,2003,2008,
	2012,2016,2021,2025,2029,2034,2038,2042,
	2047,2051,2056,2060,2064,2069,2073,2077,
	2082,2086,2090,2094,2099,2103,2107,2112,
	2116,2120,2125,2129,2133,2137,2142,2146,
	2150,2155,2159,2163,2167,2172,2176,2180,
	2184,2189,2193,2197,2201,2206,2210,2214,
	2218,2223,2227,2231,2235,2239,2244,2248,
	2252,2256,2260,2265,2269,2273,2277,2281,
	2286,2290,2294,2298,2302,2306,2311,2315,
	2319,2323,2327,2331,2335,2340,2344,2348,
	2352,2356,2360,2364,2368,2372,2377,2381,
	2385,2389,2393,2397,2401,2405,2409,2413,
	2418,2422,2426,2430,2434,2438,2442,2446,
	2450,2454,2458,2462,2466,2470,2474,2478,
	2482,2486,2490,2494,2498,2502,2506,2510,
	2514,2518,2522,2526,2530,2534,2538,2542,
	2546,2550,2554,2558,2562,2566,2570,2574,
	2578,2582,2586,2590,2594,2598,2602,2605,
	2609,2613,2617,2621,2625,2629,2633,2637,
	2641,2645,2648,2652,2656,2660,2664,2668,
	2672,2676,2679,2683,2687,2691,2695,2699,
	2703,2706,2710,2714,2718,2722,2726,2729,
	2733,2737,2741,2745,2748,2752,2756,2760,
	2764,2767,2771,2775,2779,2783,2786,2790,
	2794,2798,2801,2805,2809,2813,2816,2820,
	2824,2828,2831,2835,2839,2843,2846,2850,
	2854,2857,2861,2865,2869,2872,2876,2880,
	2883,2887,2891,2894,2898,2902,2905,2909,
	2913,2916,2920,2924,2927,2931,2935,2938,
	2942,2946,2949,2953,2956,2960,2964,2967,
	2971,2974,2978,2982,2985,2989,2992,2996,
	3000,3003,3007,3010,3014,3018,3021,3025,
	3028,3032,3035,3039,3042,3046,3050,3053,
	3057,3060,3064,3067,3071,3074,3078,3081,
	3085,3088,3092,3095,3099,3102,3106,3109,
	3113,3116,3120,3123,3127,3130,3134,3137,
	3141,3144,3147,3151,3154,3158,3161,3165,
	3168,3172,3175,3178,3182,3185,3189,3192,
	3195,3199,3202,3206,3209,3212,3216,3219,
	3223,3226,3229,3233,3236,3240,3243,3246,
	3250,3253,3256,3260,3263,3266,3270,3273,
	3276,3280,3283,3286,3290,3293,3296,3300,
	3303,3306,3310,3313,3316,3319,3323,3326,
	3329,3333,3336,3339,3342,3346,3349,3352,
	3355,3359,3362,3365,3368,3372,3375,3378,
	3381,3385,3388,3391,3394,3398,3401,3404,
	3407,3410,3414,3417,3420,3423,3426,3430,
	3433,3436,3439,3442,3446,3449,3452,3455,
	3458,3461,3465,3468,3471,3474,3477,3480,
	3483,3487,3490,3493,3496,3499,3502,3505,
	3508,3512,3515,3518,3521,3524,3527,3530,
	3533,3536,3539,3543,3546,3549,3552,3555,
	3558,3561,3564,3567,3570,3573,3576,3579,
	3582,3585,3588,3591,3595,3598,3601,3604,
	3607,3610,3613,3616,3619,3622,3625,3628,
	3631,3634,3637,3640,3643,3646,3649,3652,
	3655,3658,3661,3664,3666,3669,3672,3675,
	3678,3681,3684,3687,3690,3693,3696,3699,
	3702,3705,3708,3711,3714,3716,3719,3722,
	3725,3728,3731,3734,3737,3740,3743,3745,
	3748,3751,3754,3757,3760,3763,3766,3768,
	3771,3774,3777,3780,3783,3786,3788,3791,
	3794,3797,3800,3803,3805,3808,3811,3814,
	3817,3820,3822,3825,3828,3831,3834,3836,
	3839,3842,3845,3848,3850,3853,3856,3859,
	3862,3864,3867,3870,3873,3875,3878,3881,
	3884,3886,3889,3892,3895,3897,3900,3903,
	3906,3908,3911,3914,3916,3919,3922,3925,
	3927,3930,3933,3935,3938,3941,3944,3946,
	3949,3952,3954,3957,3960,3962,3965,3968,
	3970,3973,3976,3978,3981,3984,3986,3989,
	3992,3994,3997,4000,4002,4005,4007,4010,
	4013,4015,4018,4021,4023,4026,4028,4031,
	4034,4036,4039,4041,4044,4047,4049,4052,
	4054,4057,4060,4062,4065,4067,4070,4072,
	4075,4078,4080,4083,4085,4088,4090,4093,
	4096
};

int atan20(int y, int x)
{
	if (y >= 0) {
		if (x >= 0) {
			if (y < x) {
				return atan_table[y*ATAN_TABLE_LENGTH/x];
			}
			if (y == 0) {
				return 0;
			}
			return M_PI/2*1 - atan_table[x*ATAN_TABLE_LENGTH/y];
		}
		y = -y;
		if (y > x) {
			return M_PI/2*2 - atan_table[y*ATAN_TABLE_LENGTH/x];
		}
		return M_PI/2*1 + atan_table[x*ATAN_TABLE_LENGTH/y];
	}
	if (x <= 0) {
		if (y > x) {
			return M_PI/2*2 + atan_table[y*ATAN_TABLE_LENGTH/x];
		}
		return M_PI/2*3 - atan_table[x*ATAN_TABLE_LENGTH/y];
	}
	x = -x;
	if (y > x) {
		return M_PI/2*4 - atan_table[y*ATAN_TABLE_LENGTH/x];
	}
	return M_PI/2*3 + atan_table[x*ATAN_TABLE_LENGTH/y];
}
